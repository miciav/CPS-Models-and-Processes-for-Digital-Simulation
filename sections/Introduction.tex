In the manufacturing context, simulation refers to an ample spectrum of methodologies, techniques, and resulting software applications aimed at modeling and analyzing, through numerical experiments, the behavior of real production systems \cite{chung2003simulation, bangsow2010manufacturing}. 
The availability of models and tools to support the execution of accurate simulations of backbone processes in manufacturing is widely acknowledged as essential to making informed operational decisions at the shop floor level. 
Yet, the high complexity of distributed value networks calls for reactive management systems that extend beyond the single company borders and disciplinary domains, envisioning the application of simulation tools at the core of novel cooperative digital environments. 

Historically, simulation solutions have been relegated only in the initial phases of factory design or in specific analyses targeting separated factory domains such as process validation, optimization of production layouts, scheduling, and purchasing forecast~\cite{fowler2004grand}.
This limited scope stems from the fact that the application of simulation techniques to the traditional shop has proven to be a challenging and resource-eager activity, whereas the underlying models are often so sensitive to even small variations of context parameters to result in steep time-increasing prediction errors. 
Consequently, the simulation has been regarded as some sort of chimera that promises great benefits and yet has never been really suitable for operative and reactive decisions. 

The landscape, nonetheless, is on the verge of a radical change thanks to the disruptive transformations witnessed in recent years and that are known by the term \textit{Industry 4.0} (I4.0)~\cite{Lu2017}. 
In particular, many manufacturers have adopted (or are in the process of adopting) approaches and methodologies that are typical of the Information and Communication Technology (ICT) industry with the aim of creating the \textit{Smart Factory}~\cite{Lee2015,Hozdic2015}, that is an integrated ecosystem where the use of innovative technologies such as \textit{Machine Learning}, \textit{Big Data} and the \textit{Internet of Things}will be at the service of future production and managerial operations~\cite{Witkowski2017,Xu2014}.
In this context, the shop floor is redefined being envisioned as the composition of self-monitoring fast-reconfigurable objects (mainly, machinery and robots), often referred to as \textit{Cyber-Physical Systems} (CPSs)~\cite{Jazdi2014}, equipped with computational resources and capable of establishing a capillary sensing by sharing their state information as well as coordination signals with other (possibly geographically distributed) stakeholders. 
Indeed, through different connection media (e.g., the RAMI 4.0 data buses~\cite{hankel2015reference}) this information can be exchanged, stored, and eventually used to finally achieve, among other things, reliable and accurate simulations over all phases of the factory life cycle. 
Moreover, since computational and reasoning capabilities are distributed with CPSs, the classical simulation approach can be overturned by distributing the burden among the various CPS living in the Smart Factory (i.e. gateways, production machinery, robots) exploiting emerging paradigms such as the \textit{Edge Computing}~\cite{georgakopoulos2016internet}. 
Such a scenario would have the undisputed advantage of increasing reactivity (because data movement is reduced) and simulation precision (each element self-simulates using accurate models because they can be developed by the machine vendors). 


Withal, thanks to the real-time and ubiquitous availability of information, the distance between the simulation run-time and the real factory situation results shortened. 
This enables the harnessing of digital avatars (a.k.a. \textit{Digital Twins}~\cite{Uhlemann2017}) to represent and interact with every actor involved in the manufacturing process; if a sufficient degree on composability is featured by such digital objects, even the whole shop floor can be mirrored in real-time within a simulation setup.   
The ability to mirror real elements into their virtual representation, will enable the forthcoming platforms to simulate on top of constantly updated data, thus exploiting the full potentials of simulation; next generation solutions will, therefore, no more be relegated to the factory design and planning phases but will pervade the everyday work undertakings.
In fact, if from one side the traditional approach based on \textit{what-if} scenarios, where the effect of (re-)design choices are analyzed without having to involve the real shop floor, will benefit from more accurate and fresh data, on the other side the same availability of reliable information will provide support to \textit{now-what} decision-making processes that are currently outside the boundaries of simulation, such as reactive reallocation of production resources to balance the production following an unexpected event or ensuing the on-time delivery of customer orders by reducing the effect of uncertainties.


Notwithstanding the staggering achievements witnessed in these recent years, as pointed out in~\cite{pedrazzoli2014simulation}, there exist still relevant challenges affecting the maturity level in the adoption of I4.0 enablers in simulation and forecasting. 
Firstly, although high-performing computing services are available in the Cloud, simulation still under-exploits them, being almost always stuck in a centralized and localized vision that fails to take advantage of the opportunities offered by a distributed (Cloud) and, recently, on-board (Edge computing) paradigms.
Even the game-changing possibility to reliably collect and use in real-time data to mirror the factory is not currently exploited within simulation tools still struggling in the definition of virtual factory models~\cite{ciavotta2017microservice}.
Lack of flexible and extensible data models are hindering the emergence of multi-disciplinary simulation technologies to support the virtual investigation in a holistic perspective that promotes decision-making processes enriched by the analysis of the multiple domains interacting within the factory~\cite{hehenberger2016design}.
Ultimately, digital models need to evolve coherently with production systems along their life-cycles to leap over both punctual and paradigmatic transformations taking place in the shop floor and in the  information systems that support them \cite{azab2012simulation}.

This chapter aims at presenting and discussing some of the results, obtained in the framework of FAR-EDGE, a European H2020 project, in the field of digital twin modelling and synchronization using data from the field with the purpose of improving simulation reliability. 

This chapter proposes four items that lead the path of simulation technology development to embrace and empower the digital transformation of industry. 

First, a \textbf{CPS virtualization and simulation model}, relying on a shared core language that can be expanded to suit specific purposes, is required to sustain integration of different domains and provision of Cloud- or Edge-based simulation services. 
Especially SMEs, the least capable among industrial organizations to access the benefits of simulation, will profit from this democratizing approach that removes or reduces the adoption barriers while expanding the scope of simulation.

This shared language will pave the grounds for achieving the \textbf{Digital Continuity}, that regards the definition and continuous update of CPS digital doppelgangers (a.k.a. Digital Twin) to create live digital copies of  environments and processes thus making it possible to oversee and control them on a factual basis.  A fully implemented digital continuity, together with flexible and reconfigurable simulation models will leverage the smart nature of CPSs pursuing the \textbf{Plug-and-Simulate} condition. Plug-and-simulate will make adding new resources or modifying their behavior to be automatically or semi-automatically notified to the system in order to create a corresponding ready-to-use digital twin.

Finally, he achievement of the above mentioned items will allow simulation to take its rightful place at the heart of factory operations (\textbf{Simulation in the loop}),  dramatically change its role from a predictive and testing technique that is used ex-ante to make decisions on possible configuration alternatives, to a responsive and holistic tool to support decision-making in real-time scenarios.



The remainder of the chapter is structured as follows, in Section`\ref{sec:project} the objectives of this work are presented in broad terms and framed within the framework of the international research project FAR-EDGE; Section~\ref{sec:model} instead describes the fundamental elements of the CPS simulation and synchronization model, highlighting the characteristics that support the Digital Continuity. Section~\ref{sec:r2ds} focuses on the description and discussion of the real-digital synchronization system. A case study is presented in Section~\ref{sec:caseStudy} whereas, a glimpse into the future, in which simulation will play a central role in the management of the intelligent factory, is provided in Section~\ref{sec:d2rs}, where possible scenarios are discussed. Finally, the conclusions are drawn in Section~\ref{sec:conclusions}.  






